<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’¸è´§ç®¡ç†ç³»ç»Ÿ - æ‹æ‰‹ç«¯/ç®¡ç†å‘˜ç«¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }
        
        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .login-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .login-box button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-box button:hover {
            background: #5a67d8;
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        
        .login-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
        }
        
        .login-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            margin-bottom: -2px;
        }
        
        /* ç®¡ç†å‘˜ç«¯æ ·å¼ */
        .admin-container {
            display: none;
            min-height: 100vh;
            background: #f0f2f5;
        }
        
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header h1 {
            font-size: 24px;
        }
        
        .admin-header .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .admin-header button {
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .admin-nav {
            background: white;
            padding: 0 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 30px;
        }
        
        .admin-nav-item {
            padding: 15px 0;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .admin-nav-item.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .admin-content {
            padding: 30px;
        }
        
        .admin-panel {
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        /* æ‹æ‰‹ç«¯æ ·å¼ */
        .paishou-container {
            display: none;
            min-height: 100vh;
            background: #f8f9fa;
        }
        
        .paishou-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .paishou-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .paishou-header p {
            opacity: 0.9;
        }
        
        .paishou-content {
            max-width: 800px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .order-form {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .order-form h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .product-list {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .product-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 30px;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .product-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        .remove-product {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-product {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .btn-submit {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-submit:hover {
            background: #5a67d8;
        }
        
        .order-history {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .order-history h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .order-card {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s;
        }
        
        .order-card:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .order-id {
            font-weight: bold;
            color: #333;
        }
        
        .order-status {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #f39c12;
            color: white;
        }
        
        .status-matched {
            background: #27ae60;
            color: white;
        }
        
        .status-partial {
            background: #e67e22;
            color: white;
        }
        
        .order-detail {
            font-size: 14px;
            color: #666;
        }
        
        .order-detail p {
            margin: 5px 0;
        }
        
        /* ç®¡ç†å‘˜è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .search-box button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .btn-edit {
            background: #3498db;
            color: white;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn-check {
            background: #27ae60;
            color: white;
        }
        
        .share-link {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        
        .share-link input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .copy-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        @media (max-width: 768px) {
            .product-item {
                grid-template-columns: 1fr;
            }
            
            .admin-nav {
                padding: 0 15px;
                gap: 15px;
                overflow-x: auto;
            }
            
            .admin-nav-item {
                padding: 10px 0;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h2>æ’¸è´§ç®¡ç†ç³»ç»Ÿ</h2>
            <div class="login-tabs">
                <div class="login-tab active" onclick="switchLoginTab('paishou')">æ‹æ‰‹ç™»å½•</div>
                <div class="login-tab" onclick="switchLoginTab('admin')">ç®¡ç†å‘˜ç™»å½•</div>
            </div>
            
            <!-- æ‹æ‰‹ç™»å½• -->
            <div id="paishouLogin">
                <input type="text" id="paishouName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                <input type="tel" id="paishouPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                <button onclick="paishouLogin()">è¿›å…¥æ‹æ‰‹ç«¯</button>
            </div>
            
            <!-- ç®¡ç†å‘˜ç™»å½• -->
            <div id="adminLogin" style="display: none;">
                <input type="text" id="adminUsername" placeholder="ç®¡ç†å‘˜è´¦å·">
                <input type="password" id="adminPassword" placeholder="å¯†ç ">
                <button onclick="adminLogin()">è¿›å…¥ç®¡ç†ç«¯</button>
                <p style="text-align: center; margin-top: 15px; color: #999; font-size: 12px;">é»˜è®¤è´¦å·ï¼šadmin å¯†ç ï¼šadmin123</p>
            </div>
        </div>
    </div>
    
    <!-- æ‹æ‰‹ç«¯ -->
    <div class="paishou-container" id="paishouPage">
        <div class="paishou-header">
            <h1>æ’¸è´§æ‹æ‰‹ç«¯</h1>
            <p id="paishouWelcome">æ¬¢è¿æ‚¨ï¼Œ</p>
        </div>
        
        <div class="paishou-content">
            <div class="stats-card">
                <div class="stat-item">
                    <div class="stat-value" id="totalOrdersCount">0</div>
                    <div class="stat-label">æ€»æŠ¥å•æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pendingOrdersCount">0</div>
                    <div class="stat-label">å¾…æ ¸å¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completedOrdersCount">0</div>
                    <div class="stat-label">å·²ç»“è´¦</div>
                </div>
            </div>
            
            <div class="order-form">
                <h2>æ–°å»ºæŠ¥å•</h2>
                <div class="form-group">
                    <label>ä¸‹å•äºº *</label>
                    <input type="text" id="orderName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" value="">
                </div>
                
                <div class="form-group">
                    <label>å¿«é€’å•å· *</label>
                    <input type="text" id="trackingNumber" placeholder="è¯·è¾“å…¥å¿«é€’å•å·">
                </div>
                
                <div class="form-group">
                    <label>äº§å“ä¿¡æ¯</label>
                    <div id="productList" class="product-list">
                        <!-- äº§å“åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="add-product" onclick="addProductField()">+ æ·»åŠ äº§å“</button>
                </div>
                
                <div class="form-group">
                    <label>æ€»é‡‘é¢ *</label>
                    <input type="number" id="totalAmount" placeholder="è¯·è¾“å…¥æ€»é‡‘é¢" step="0.01" min="0">
                </div>
                
                <button class="btn-submit" onclick="submitOrder()">æäº¤æŠ¥å•</button>
            </div>
            
            <div class="order-history">
                <h2>æˆ‘çš„æŠ¥å•è®°å½•</h2>
                <div id="paishouOrderList"></div>
            </div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜ç«¯ -->
    <div class="admin-container" id="adminPage">
        <div class="admin-header">
            <h1>æ’¸è´§ç®¡ç†ç«¯</h1>
            <div class="user-info">
                <span>ç®¡ç†å‘˜ï¼š<span id="adminName">admin</span></span>
                <button onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
        
        <div class="admin-nav">
            <div class="admin-nav-item active" onclick="switchAdminPanel('orders')">æŠ¥å•ç®¡ç†</div>
            <div class="admin-nav-item" onclick="switchAdminPanel('inbound')">å…¥åº“ç®¡ç†</div>
            <div class="admin-nav-item" onclick="switchAdminPanel('check')">æ ¸å¯¹ç»“è´¦</div>
            <div class="admin-nav-item" onclick="switchAdminPanel('paishou')">æ‹æ‰‹ç®¡ç†</div>
            <div class="admin-nav-item" onclick="switchAdminPanel('share')">åˆ†äº«é“¾æ¥</div>
        </div>
        
        <div class="admin-content">
            <!-- æŠ¥å•ç®¡ç†é¢æ¿ -->
            <div class="admin-panel active" id="ordersPanel">
                <h2 style="margin-bottom: 20px;">æŠ¥å•ç®¡ç†</h2>
                <div class="search-box">
                    <input type="text" id="orderSearch" placeholder="æœç´¢æŠ¥å•å·ã€ä¸‹å•äººã€ç”µè¯ã€å¿«é€’å•å·...">
                    <button onclick="searchOrders()">æœç´¢</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>æŠ¥å•å·</th>
                                <th>ä¸‹å•äºº</th>
                                <th>ç”µè¯</th>
                                <th>å¿«é€’å•å·</th>
                                <th>äº§å“ä¿¡æ¯</th>
                                <th>æ€»é‡‘é¢</th>
                                <th>æŠ¥å•æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="adminOrderList"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- å…¥åº“ç®¡ç†é¢æ¿ -->
            <div class="admin-panel" id="inboundPanel">
                <h2 style="margin-bottom: 20px;">å…¥åº“ç®¡ç†</h2>
                <button class="add-product" onclick="showAddInboundModal()" style="margin-bottom: 20px;">+ æ–°å»ºå…¥åº“</button>
                
                <div class="search-box">
                    <input type="text" id="inboundSearch" placeholder="æœç´¢å…¥åº“å•å·ã€å¿«é€’å•å·ã€æŠ¥å•å·...">
                    <button onclick="searchInbound()">æœç´¢</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>å…¥åº“å•å·</th>
                                <th>å¿«é€’å•å·</th>
                                <th>å…³è”æŠ¥å•</th>
                                <th>äº§å“ä¿¡æ¯</th>
                                <th>å…¥åº“æ—¶é—´</th>
                                <th>æ“ä½œäºº</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="inboundList"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ ¸å¯¹ç»“è´¦é¢æ¿ -->
            <div class="admin-panel" id="checkPanel">
                <h2 style="margin-bottom: 20px;">æ ¸å¯¹ç»“è´¦</h2>
                <div style="margin-bottom: 20px;">
                    <button class="add-product" onclick="autoMatchAll()">è‡ªåŠ¨åŒ¹é…</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>æŠ¥å•å·</th>
                                <th>ä¸‹å•äºº</th>
                                <th>ç”µè¯</th>
                                <th>æŠ¥å•é‡‘é¢</th>
                                <th>å·²å…¥åº“é‡‘é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="checkList"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ‹æ‰‹ç®¡ç†é¢æ¿ -->
            <div class="admin-panel" id="paishouPanel">
                <h2 style="margin-bottom: 20px;">æ‹æ‰‹ç®¡ç†</h2>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>æ‹æ‰‹å§“å</th>
                                <th>ç”µè¯</th>
                                <th>æ€»æŠ¥å•æ•°</th>
                                <th>æ€»é‡‘é¢</th>
                                <th>å¾…ç»“è´¦</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="paishouList"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- åˆ†äº«é“¾æ¥é¢æ¿ -->
            <div class="admin-panel" id="sharePanel">
                <h2 style="margin-bottom: 20px;">åˆ†äº«æŠ¥å•é“¾æ¥</h2>
                
                <div class="share-link">
                    <input type="text" id="shareUrl" readonly value="è¯·å…ˆå¤åˆ¶å½“å‰é¡µé¢åœ°å€">
                    <button class="copy-btn" onclick="copyShareLink()">å¤åˆ¶é“¾æ¥</button>
                </div>
                
                <p style="color: #666; margin-top: 10px;">å°†ä»¥ä¸Šé“¾æ¥å‘é€ç»™æ‹æ‰‹ï¼Œæ‹æ‰‹æ‰“å¼€åå³å¯è‡ªåŠ©æŠ¥å•</p>
                
                <div style="margin-top: 30px;">
                    <h3>ä½¿ç”¨è¯´æ˜</h3>
                    <ul style="margin-top: 10px; color: #666; line-height: 1.8;">
                        <li>æ‹æ‰‹æ‰“å¼€é“¾æ¥åï¼Œè¾“å…¥å§“åå’Œæ‰‹æœºå·å³å¯ç™»å½•</li>
                        <li>ç™»å½•åå¯æŸ¥çœ‹è‡ªå·±çš„æŠ¥å•è®°å½•å’ŒçŠ¶æ€</li>
                        <li>æ¯æ¬¡æŠ¥å•åªéœ€å¡«å†™ï¼šä¸‹å•äººã€å¿«é€’å•å·ã€äº§å“ä¿¡æ¯ã€æ€»é‡‘é¢</li>
                        <li>ç®¡ç†å‘˜å¯åœ¨åå°æŸ¥çœ‹æ‰€æœ‰æŠ¥å•å¹¶è¿›è¡Œå…¥åº“æ ¸å¯¹</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å…¥åº“æ¨¡æ€æ¡† -->
    <div class="modal" id="inboundModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('inboundModal')">&times;</span>
            <h3>æ·»åŠ å…¥åº“</h3>
            
            <div class="form-group">
                <label>å¿«é€’å•å· *</label>
                <input type="text" id="inboundTracking" placeholder="è¯·è¾“å…¥å¿«é€’å•å·">
            </div>
            
            <div class="form-group">
                <label>å…³è”æŠ¥å•å·</label>
                <input type="text" id="inboundOrderId" placeholder="è¯·è¾“å…¥æŠ¥å•å·ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="form-group">
                <label>äº§å“ä¿¡æ¯</label>
                <div id="inboundProductList" class="product-list"></div>
                <button class="add-product" onclick="addInboundProduct()">+ æ·»åŠ äº§å“</button>
            </div>
            
            <div class="form-group">
                <label>æ“ä½œäºº</label>
                <input type="text" id="inboundOperator" placeholder="è¯·è¾“å…¥æ“ä½œäººå§“å">
            </div>
            
            <button class="btn-submit" onclick="saveInbound()">ä¿å­˜å…¥åº“</button>
        </div>
    </div>
    
    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('detailModal')">&times;</span>
            <h3>è¯¦ç»†ä¿¡æ¯</h3>
            <div id="detailContent"></div>
        </div>
    </div>
    
    <script>
        // æ•°æ®å­˜å‚¨
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let inbounds = JSON.parse(localStorage.getItem('inbounds')) || [];
        let paishouUsers = JSON.parse(localStorage.getItem('paishouUsers')) || [];
        
        // å½“å‰ç™»å½•ç”¨æˆ·
        let currentUser = null;
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        if (orders.length === 0) {
            orders.push({
                id: 'BD20250220001',
                paishouName: 'å¼ ä¸‰',
                paishouPhone: '13800138001',
                trackingNumber: 'SF123456789',
                products: [
                    { name: 'iPhone 15', spec: '128G é»‘è‰²', quantity: 2 }
                ],
                totalAmount: 11998,
                createTime: '2025-02-20 10:30',
                status: 'pending'
            });
            
            orders.push({
                id: 'BD20250220002',
                paishouName: 'æå››',
                paishouPhone: '13800138002',
                trackingNumber: 'YT987654321',
                products: [
                    { name: 'åä¸ºMate 60', spec: '12+512G', quantity: 1 }
                ],
                totalAmount: 6999,
                createTime: '2025-02-20 11:15',
                status: 'pending'
            });
            
            saveOrders();
        }
        
        if (inbounds.length === 0) {
            inbounds.push({
                id: 'RK20250220001',
                trackingNumber: 'SF123456789',
                orderId: 'BD20250220001',
                products: [
                    { name: 'iPhone 15', spec: '128G é»‘è‰²', quantity: 1 }
                ],
                operator: 'ä»“åº“ç‹',
                createTime: '2025-02-20 15:30'
            });
            
            saveInbounds();
        }
        
        // ä¿å­˜æ•°æ®
        function saveOrders() {
            localStorage.setItem('orders', JSON.stringify(orders));
        }
        
        function saveInbounds() {
            localStorage.setItem('inbounds', JSON.stringify(inbounds));
        }
        
        function savePaishouUsers() {
            localStorage.setItem('paishouUsers', JSON.stringify(paishouUsers));
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateId(prefix) {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `${prefix}${year}${month}${day}${random}`;
        }
        
        // è·å–å½“å‰æ—¶é—´
        function getCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }
        
        // ç™»å½•ç›¸å…³
        function switchLoginTab(type) {
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (type === 'paishou') {
                document.getElementById('paishouLogin').style.display = 'block';
                document.getElementById('adminLogin').style.display = 'none';
            } else {
                document.getElementById('paishouLogin').style.display = 'none';
                document.getElementById('adminLogin').style.display = 'block';
            }
        }
        
        function paishouLogin() {
            const name = document.getElementById('paishouName').value.trim();
            const phone = document.getElementById('paishouPhone').value.trim();
            
            if (!name || !phone) {
                alert('è¯·è¾“å…¥å§“åå’Œæ‰‹æœºå·');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ‹æ‰‹
            let user = paishouUsers.find(u => u.name === name && u.phone === phone);
            if (!user) {
                user = {
                    id: generateId('PS'),
                    name: name,
                    phone: phone,
                    registerTime: getCurrentTime()
                };
                paishouUsers.push(user);
                savePaishouUsers();
            }
            
            currentUser = user;
            
            // æ˜¾ç¤ºæ‹æ‰‹ç«¯
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('paishouPage').style.display = 'block';
            document.getElementById('paishouWelcome').textContent = `æ¬¢è¿æ‚¨ï¼Œ${name}`;
            document.getElementById('orderName').value = name;
            
            loadPaishouOrders();
        }
        
        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            
            if (username === 'admin' && password === 'admin123') {
                currentUser = { name: 'admin', role: 'admin' };
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPage').style.display = 'block';
                document.getElementById('adminName').textContent = 'admin';
                
                loadAdminOrders();
                loadInboundList();
                loadCheckList();
                loadPaishouList();
                
                // è®¾ç½®åˆ†äº«é“¾æ¥
                const shareUrl = window.location.href;
                document.getElementById('shareUrl').value = shareUrl;
            } else {
                alert('è´¦å·æˆ–å¯†ç é”™è¯¯');
            }
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('paishouPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'none';
        }
        
        // æ‹æ‰‹ç«¯åŠŸèƒ½
        function addProductField() {
            const productList = document.getElementById('productList');
            const newField = document.createElement('div');
            newField.className = 'product-item';
            newField.innerHTML = `
                <input type="text" placeholder="äº§å“åç§°" class="product-name">
                <input type="text" placeholder="å£å‘³/è§„æ ¼" class="product-spec">
                <input type="number" placeholder="æ•°é‡" class="product-quantity" value="1" min="1">
                <input type="text" placeholder="å›ºå" class="product-gufan">
                <button class="remove-product" onclick="removeProductField(this)">Ã—</button>
            `;
            productList.appendChild(newField);
        }
        
        function removeProductField(btn) {
            if (document.querySelectorAll('#productList .product-item').length > 1) {
                btn.parentElement.remove();
            }
        }
        
        function submitOrder() {
            const name = document.getElementById('orderName').value.trim();
            const trackingNumber = document.getElementById('trackingNumber').value.trim();
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            
            if (!name || !trackingNumber || !totalAmount || totalAmount <= 0) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const productItems = document.querySelectorAll('#productList .product-item');
            const products = [];
            
            for (let item of productItems) {
                const productName = item.querySelector('.product-name').value.trim();
                const spec = item.querySelector('.product-spec').value.trim();
                const quantity = parseInt(item.querySelector('.product-quantity').value) || 0;
                const gufan = item.querySelector('.product-gufan').value.trim();
                
                if (productName && quantity > 0) {
                    products.push({
                        name: productName,
                        spec: spec,
                        quantity: quantity,
                        gufan: gufan
                    });
                }
            }
            
            if (products.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªäº§å“');
                return;
            }
            
            const newOrder = {
                id: generateId('BD'),
                paishouName: name,
                paishouPhone: currentUser.phone,
                trackingNumber: trackingNumber,
                products: products,
                totalAmount: totalAmount,
                createTime: getCurrentTime(),
                status: 'pending'
            };
            
            orders.push(newOrder);
            saveOrders();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('trackingNumber').value = '';
            document.getElementById('totalAmount').value = '';
            document.getElementById('productList').innerHTML = `
                <div class="product-item">
                    <input type="text" placeholder="äº§å“åç§°" class="product-name">
                    <input type="text" placeholder="å£å‘³/è§„æ ¼" class="product-spec">
                    <input type="number" placeholder="æ•°é‡" class="product-quantity" value="1" min="1">
                    <input type="text" placeholder="å›ºå" class="product-gufan">
                    <button class="remove-product" onclick="removeProductField(this)">Ã—</button>
                </div>
            `;
            
            loadPaishouOrders();
            alert('æŠ¥å•æäº¤æˆåŠŸï¼');
        }
        
        function loadPaishouOrders() {
            const userOrders = orders.filter(o => o.paishouPhone === currentUser.phone);
            
            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('totalOrdersCount').textContent = userOrders.length;
            document.getElementById('pendingOrdersCount').textContent = userOrders.filter(o => o.status !== 'matched').length;
            document.getElementById('completedOrdersCount').textContent = userOrders.filter(o => o.status === 'matched').length;
            
            const orderList = document.getElementById('paishouOrderList');
            
            if (userOrders.length === 0) {
                orderList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— æŠ¥å•è®°å½•</p>';
                return;
            }
            
            let html = '';
            userOrders.sort((a, b) => b.createTime.localeCompare(a.createTime)).forEach(order => {
                const productInfo = order.products.map(p => 
                    `${p.name} ${p.spec} x${p.quantity} ${p.gufan ? '(å›ºå:' + p.gufan + ')' : ''}`
                ).join('<br>');
                
                const statusText = order.status === 'pending' ? 'å¾…æ ¸å¯¹' : 
                                  order.status === 'matched' ? 'å·²ç»“è´¦' : 'éƒ¨åˆ†æ ¸å¯¹';
                const statusClass = order.status === 'pending' ? 'status-pending' : 
                                   order.status === 'matched' ? 'status-matched' : 'status-partial';
                
                html += `
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-id">${order.id}</span>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="order-detail">
                            <p>ğŸ“¦ å¿«é€’å•å·ï¼š${order.trackingNumber}</p>
                            <p>ğŸ“¦ äº§å“ä¿¡æ¯ï¼š</p>
                            <p style="margin-left: 20px;">${productInfo}</p>
                            <p>ğŸ’° æ€»é‡‘é¢ï¼šÂ¥${order.totalAmount.toFixed(2)}</p>
                            <p>â° æŠ¥å•æ—¶é—´ï¼š${order.createTime}</p>
                        </div>
                    </div>
                `;
            });
            
            orderList.innerHTML = html;
        }
        
        // ç®¡ç†å‘˜ç«¯åŠŸèƒ½
        function switchAdminPanel(panel) {
            document.querySelectorAll('.admin-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.admin-panel').forEach(p => {
                p.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(panel + 'Panel').classList.add('active');
            
            // åˆ·æ–°å¯¹åº”é¢æ¿æ•°æ®
            if (panel === 'orders') loadAdminOrders();
            else if (panel === 'inbound') loadInboundList();
            else if (panel === 'check') loadCheckList();
            else if (panel === 'paishou') loadPaishouList();
        }
        
        function loadAdminOrders() {
            const tbody = document.getElementById('adminOrderList');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">æš‚æ— æŠ¥å•æ•°æ®</td></tr>';
                return;
            }
            
            let html = '';
            orders.sort((a, b) => b.createTime.localeCompare(a.createTime)).forEach(order => {
                const productInfo = order.products.map(p => 
                    `${p.name} ${p.spec} x${p.quantity}`
                ).join('<br>');
                
                const statusText = order.status === 'pending' ? 'å¾…æ ¸å¯¹' : 
                                  order.status === 'matched' ? 'å·²ç»“è´¦' : 'éƒ¨åˆ†æ ¸å¯¹';
                const statusClass = order.status === 'pending' ? 'status-pending' : 
                                   order.status === 'matched' ? 'status-matched' : 'status-partial';
                
                html += `<tr>
                    <td>${order.id}</td>
                    <td>${order.paishouName}</td>
                    <td>${order.paishouPhone}</td>
                    <td>${order.trackingNumber}</td>
                    <td>${productInfo}</td>
                    <td>Â¥${order.totalAmount.toFixed(2)}</td>
                    <td>${order.createTime}</td>
                    <td><span class="order-status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-btn btn-check" onclick="viewOrderDetail('${order.id}')">æŸ¥çœ‹</button>
                        <button class="action-btn btn-delete" onclick="deleteOrder('${order.id}')">åˆ é™¤</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        function searchOrders() {
            const keyword = document.getElementById('orderSearch').value.toLowerCase();
            
            const filtered = orders.filter(order => 
                order.id.toLowerCase().includes(keyword) ||
                order.paishouName.toLowerCase().includes(keyword) ||
                order.paishouPhone.includes(keyword) ||
                order.trackingNumber.toLowerCase().includes(keyword)
            );
            
            const tbody = document.getElementById('adminOrderList');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">æœªæ‰¾åˆ°åŒ¹é…è®°å½•</td></tr>';
                return;
            }
            
            let html = '';
            filtered.forEach(order => {
                const productInfo = order.products.map(p => 
                    `${p.name} ${p.spec} x${p.quantity}`
                ).join('<br>');
                
                const statusText = order.status === 'pending' ? 'å¾…æ ¸å¯¹' : 
                                  order.status === 'matched' ? 'å·²ç»“è´¦' : 'éƒ¨åˆ†æ ¸å¯¹';
                const statusClass = order.status === 'pending' ? 'status-pending' : 
                                   order.status === 'matched' ? 'status-matched' : 'status-partial';
                
                html += `<tr>
                    <td>${order.id}</td>
                    <td>${order.paishouName}</td>
                    <td>${order.paishouPhone}</td>
                    <td>${order.trackingNumber}</td>
                    <td>${productInfo}</td>
                    <td>Â¥${order.totalAmount.toFixed(2)}</td>
                    <td>${order.createTime}</td>
                    <td><span class="order-status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-btn btn-check" onclick="viewOrderDetail('${order.id}')">æŸ¥çœ‹</button>
                        <button class="action-btn btn-delete" onclick="deleteOrder('${order.id}')">åˆ é™¤</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        function deleteOrder(orderId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥æŠ¥å•å—ï¼Ÿ')) {
                orders = orders.filter(o => o.id !== orderId);
                saveOrders();
                loadAdminOrders();
                loadCheckList();
            }
        }
        
        function viewOrderDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const relatedInbounds = inbounds.filter(i => i.orderId === orderId);
            
            let inboundHtml = '';
            if (relatedInbounds.length > 0) {
                inboundHtml = '<h4 style="margin: 15px 0 10px;">å…³è”å…¥åº“ï¼š</h4>';
                relatedInbounds.forEach(inb => {
                    inboundHtml += `
                        <div style="border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px;">
                            <p>å…¥åº“å•å·ï¼š${inb.id}</p>
                            <p>å¿«é€’å•å·ï¼š${inb.trackingNumber}</p>
                            <p>äº§å“ï¼š${inb.products.map(p => `${p.name} ${p.spec} x${p.quantity}`).join(', ')}</p>
                            <p>å…¥åº“æ—¶é—´ï¼š${inb.createTime}</p>
                        </div>
                    `;
                });
            } else {
                inboundHtml = '<p style="color: #999; margin: 15px 0;">æš‚æ— å…¥åº“è®°å½•</p>';
            }
            
            const productHtml = order.products.map(p => 
                `<p>â€¢ ${p.name} ${p.spec} Ã—${p.quantity} ${p.gufan ? '(å›ºå:' + p.gufan + ')' : ''}</p>`
            ).join('');
            
            document.getElementById('detailContent').innerHTML = `
                <p><strong>æŠ¥å•å·ï¼š</strong>${order.id}</p>
                <p><strong>ä¸‹å•äººï¼š</strong>${order.paishouName} ${order.paishouPhone}</p>
                <p><strong>å¿«é€’å•å·ï¼š</strong>${order.trackingNumber}</p>
                <p><strong>äº§å“æ˜ç»†ï¼š</strong></p>
                ${productHtml}
                <p><strong>æ€»é‡‘é¢ï¼š</strong>Â¥${order.totalAmount.toFixed(2)}</p>
                <p><strong>æŠ¥å•æ—¶é—´ï¼š</strong>${order.createTime}</p>
                <p><strong>çŠ¶æ€ï¼š</strong>${order.status === 'pending' ? 'å¾…æ ¸å¯¹' : order.status === 'matched' ? 'å·²ç»“è´¦' : 'éƒ¨åˆ†æ ¸å¯¹'}</p>
                ${inboundHtml}
            `;
            
            document.getElementById('detailModal').classList.add('active');
        }
        
        // å…¥åº“ç®¡ç†
        function loadInboundList() {
            const tbody = document.getElementById('inboundList');
            
            if (inbounds.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">æš‚æ— å…¥åº“æ•°æ®</td></tr>';
                return;
            }
            
            let html = '';
            inbounds.sort((a, b) => b.createTime.localeCompare(a.createTime)).forEach(inb => {
                const productInfo = inb.products.map(p => `${p.name} ${p.spec} x${p.quantity}`).join('<br>');
                
                html += `<tr>
                    <td>${inb.id}</td>
                    <td>${inb.trackingNumber}</td>
                    <td>${inb.orderId || 'æœªå…³è”'}</td>
                    <td>${productInfo}</td>
                    <td>${inb.createTime}</td>
                    <td>${inb.operator || 'æœªçŸ¥'}</td>
                    <td>
                        <button class="action-btn btn-check" onclick="viewInboundDetail('${inb.id}')">æŸ¥çœ‹</button>
                        <button class="action-btn btn-delete" onclick="deleteInbound('${inb.id}')">åˆ é™¤</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        function searchInbound() {
            const keyword = document.getElementById('inboundSearch').value.toLowerCase();
            
            const filtered = inbounds.filter(inb => 
                inb.id.toLowerCase().includes(keyword) ||
                inb.trackingNumber.toLowerCase().includes(keyword) ||
                (inb.orderId && inb.orderId.toLowerCase().includes(keyword))
            );
            
            const tbody = document.getElementById('inboundList');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">æœªæ‰¾åˆ°åŒ¹é…è®°å½•</td></tr>';
                return;
            }
            
            let html = '';
            filtered.forEach(inb => {
                const productInfo = inb.products.map(p => `${p.name} ${p.spec} x${p.quantity}`).join('<br>');
                
                html += `<tr>
                    <td>${inb.id}</td>
                    <td>${inb.trackingNumber}</td>
                    <td>${inb.orderId || 'æœªå…³è”'}</td>
                    <td>${productInfo}</td>
                    <td>${inb.createTime}</td>
                    <td>${inb.operator || 'æœªçŸ¥'}</td>
                    <td>
                        <button class="action-btn btn-check" onclick="viewInboundDetail('${inb.id}')">æŸ¥çœ‹</button>
                        <button class="action-btn btn-delete" onclick="deleteInbound('${inb.id}')">åˆ é™¤</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        function showAddInboundModal() {
            document.getElementById('inboundTracking').value = '';
            document.getElementById('inboundOrderId').value = '';
            document.getElementById('inboundOperator').value = '';
            document.getElementById('inboundProductList').innerHTML = `
                <div class="product-item">
                    <input type="text" placeholder="äº§å“åç§°" class="inbound-product-name">
                    <input type="text" placeholder="è§„æ ¼" class="inbound-product-spec">
                    <input type="number" placeholder="æ•°é‡" class="inbound-product-quantity" value="1" min="1">
                    <button class="remove-product" onclick="removeInboundProduct(this)">Ã—</button>
                </div>
            `;
            document.getElementById('inboundModal').classList.add('active');
        }
        
        function addInboundProduct() {
            const productList = document.getElementById('inboundProductList');
            const newField = document.createElement('div');
            newField.className = 'product-item';
            newField.innerHTML = `
                <input type="text" placeholder="äº§å“åç§°" class="inbound-product-name">
                <input type="text" placeholder="è§„æ ¼" class="inbound-product-spec">
                <input type="number" placeholder="æ•°é‡" class="inbound-product-quantity" value="1" min="1">
                <button class="remove-product" onclick="removeInboundProduct(this)">Ã—</button>
            `;
            productList.appendChild(newField);
        }
        
        function removeInboundProduct(btn) {
            if (document.querySelectorAll('#inboundProductList .product-item').length > 1) {
                btn.parentElement.remove();
            }
        }
        
        function saveInbound() {
            const trackingNumber = document.getElementById('inboundTracking').value.trim();
            const orderId = document.getElementById('inboundOrderId').value.trim();
            const operator = document.getElementById('inboundOperator').value.trim() || 'ç®¡ç†å‘˜';
            
            if (!trackingNumber) {
                alert('è¯·è¾“å…¥å¿«é€’å•å·');
                return;
            }
            
            const productItems = document.querySelectorAll('#inboundProductList .product-item');
            const products = [];
            
            for (let item of productItems) {
                const name = item.querySelector('.inbound-product-name').value.trim();
                const spec = item.querySelector('.inbound-product-spec').value.trim();
                const quantity = parseInt(item.querySelector('.inbound-product-quantity').value) || 0;
                
                if (name && quantity > 0) {
                    products.push({ name, spec, quantity });
                }
            }
            
            if (products.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªäº§å“');
                return;
            }
            
            const newInbound = {
                id: generateId('RK'),
                trackingNumber: trackingNumber,
                orderId: orderId || null,
                products: products,
                operator: operator,
                createTime: getCurrentTime()
            };
            
            inbounds.push(newInbound);
            saveInbounds();
            
            if (orderId) {
                updateOrderStatus(orderId);
            }
            
            closeModal('inboundModal');
            loadInboundList();
            loadCheckList();
            alert('å…¥åº“è®°å½•æ·»åŠ æˆåŠŸï¼');
        }
        
        function viewInboundDetail(inboundId) {
            const inbound = inbounds.find(i => i.id === inboundId);
            if (!inbound) return;
            
            const productHtml = inbound.products.map(p => 
                `<p>â€¢ ${p.name} ${p.spec} Ã—${p.quantity}</p>`
            ).join('');
            
            document.getElementById('detailContent').innerHTML = `
                <p><strong>å…¥åº“å•å·ï¼š</strong>${inbound.id}</p>
                <p><strong>å¿«é€’å•å·ï¼š</strong>${inbound.trackingNumber}</p>
                <p><strong>å…³è”æŠ¥å•ï¼š</strong>${inbound.orderId || 'æœªå…³è”'}</p>
                <p><strong>äº§å“æ˜ç»†ï¼š</strong></p>
                ${productHtml}
                <p><strong>æ“ä½œäººï¼š</strong>${inbound.operator}</p>
                <p><strong>å…¥åº“æ—¶é—´ï¼š</strong>${inbound.createTime}</p>
            `;
            
            document.getElementById('detailModal').classList.add('active');
        }
        
        function deleteInbound(inboundId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥å…¥åº“è®°å½•å—ï¼Ÿ')) {
                const inbound = inbounds.find(i => i.id === inboundId);
                inbounds = inbounds.filter(i => i.id !== inboundId);
                saveInbounds();
                
                if (inbound && inbound.orderId) {
                    updateOrderStatus(inbound.orderId);
                }
                
                loadInboundList();
                loadCheckList();
            }
        }
        
        // æ ¸å¯¹åŠŸèƒ½
        function loadCheckList() {
            const tbody = document.getElementById('checkList');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">æš‚æ— æŠ¥å•æ•°æ®</td></tr>';
                return;
            }
            
            let html = '';
            orders.forEach(order => {
                if (order.status === 'matched') return; // å·²ç»“è´¦çš„ä¸æ˜¾ç¤º
                
                let inboundAmount = 0;
                const relatedInbounds = inbounds.filter(i => i.orderId === order.id);
                
                // ç®€å•è®¡ç®—ï¼šå‡è®¾äº§å“ä»·æ ¼ç›¸ç­‰
                const avgPrice = order.totalAmount / order.products.reduce((sum, p) => sum + p.quantity, 0);
                
                relatedInbounds.forEach(inb => {
                    inb.products.forEach(p => {
                        inboundAmount += avgPrice * p.quantity;
                    });
                });
                
                const statusText = order.status === 'pending' ? 'å¾…æ ¸å¯¹' : 'éƒ¨åˆ†æ ¸å¯¹';
                const statusClass = order.status === 'pending' ? 'status-pending' : 'status-partial';
                
                html += `<tr>
                    <td>${order.id}</td>
                    <td>${order.paishouName}</td>
                    <td>${order.paishouPhone}</td>
                    <td>Â¥${order.totalAmount.toFixed(2)}</td>
                    <td>Â¥${inboundAmount.toFixed(2)}</td>
                    <td><span class="order-status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-btn btn-check" onclick="checkOrder('${order.id}')">æ ¸å¯¹</button>
                        <button class="action-btn btn-edit" onclick="settleOrder('${order.id}')" ${inboundAmount === 0 ? 'disabled' : ''}>ç»“è´¦</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html || '<tr><td colspan="7" style="text-align: center; padding: 30px;">æš‚æ— å¾…æ ¸å¯¹æŠ¥å•</td></tr>';
        }
        
        function checkOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const relatedInbounds = inbounds.filter(i => i.orderId === orderId);
            
            let matchHtml = '';
            let totalInbound = 0;
            
            order.products.forEach(p => {
                let inboundQty = 0;
                relatedInbounds.forEach(inb => {
                    const match = inb.products.find(ip => ip.name === p.name && ip.spec === p.spec);
                    if (match) inboundQty += match.quantity;
                });
                
                const status = inboundQty >= p.quantity ? 'âœ… å·²é½' : 
                              inboundQty > 0 ? `âš ï¸ éƒ¨åˆ† (${inboundQty}/${p.quantity})` : 'âŒ æœªåˆ°';
                totalInbound += inboundQty;
                
                matchHtml += `<p>â€¢ ${p.name} ${p.spec}ï¼šæŠ¥å• ${p.quantity}ï¼Œå·²å…¥åº“ ${inboundQty} ${status}</p>`;
            });
            
            document.getElementById('detailContent').innerHTML = `
                <p><strong>æŠ¥å•å·ï¼š</strong>${order.id}</p>
                <p><strong>ä¸‹å•äººï¼š</strong>${order.paishouName} ${order.paishouPhone}</p>
                <p><strong>å¿«é€’å•å·ï¼š</strong>${order.trackingNumber}</p>
                <p><strong>æŠ¥å•é‡‘é¢ï¼š</strong>Â¥${order.totalAmount.toFixed(2)}</p>
                <hr>
                <h4>æ ¸å¯¹æ˜ç»†ï¼š</h4>
                ${matchHtml}
                <hr>
                <p><strong>å…¥åº“è®°å½•ï¼š</strong>${relatedInbounds.length} æ¡</p>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn-submit" onclick="settleOrder('${orderId}')" style="width: auto; padding: 10px 20px;" ${totalInbound === 0 ? 'disabled' : ''}>ç¡®è®¤ç»“è´¦</button>
                </div>
            `;
            
            document.getElementById('detailModal').classList.add('active');
        }
        
        function settleOrder(orderId) {
            if (confirm('ç¡®è®¤ç»™æ‹æ‰‹ç»“è´¦å—ï¼Ÿ')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'matched';
                    saveOrders();
                    loadCheckList();
                    loadAdminOrders();
                    closeModal('detailModal');
                    alert('ç»“è´¦å®Œæˆï¼');
                }
            }
        }
        
        function autoMatchAll() {
            inbounds.forEach(inb => {
                if (!inb.orderId) {
                    // é€šè¿‡å¿«é€’å•å·åŒ¹é…
                    const matchedOrder = orders.find(o => o.trackingNumber === inb.trackingNumber);
                    if (matchedOrder) {
                        inb.orderId = matchedOrder.id;
                    }
                }
            });
            
            saveInbounds();
            
            orders.forEach(order => updateOrderStatus(order.id));
            
            loadCheckList();
            loadInboundList();
            alert('è‡ªåŠ¨åŒ¹é…å®Œæˆï¼');
        }
        
        function updateOrderStatus(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const relatedInbounds = inbounds.filter(i => i.orderId === orderId);
            let totalInboundQty = 0;
            let totalOrderQty = 0;
            
            order.products.forEach(p => {
                totalOrderQty += p.quantity;
                relatedInbounds.forEach(inb => {
                    const match = inb.products.find(ip => ip.name === p.name && ip.spec === p.spec);
                    if (match) totalInboundQty += match.quantity;
                });
            });
            
            if (totalInboundQty >= totalOrderQty) {
                order.status = 'matched';
            } else if (totalInboundQty > 0) {
                order.status = 'partial';
            } else {
                order.status = 'pending';
            }
            
            saveOrders();
        }
        
        // æ‹æ‰‹ç®¡ç†
        function loadPaishouList() {
            const tbody = document.getElementById('paishouList');
            
            if (paishouUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px;">æš‚æ— æ‹æ‰‹æ•°æ®</td></tr>';
                return;
            }
            
            let html = '';
            paishouUsers.forEach(user => {
                const userOrders = orders.filter(o => o.paishouPhone === user.phone);
                const totalAmount = userOrders.reduce((sum, o) => sum + o.totalAmount, 0);
                const pendingAmount = userOrders.filter(o => o.status !== 'matched')
                    .reduce((sum, o) => sum + o.totalAmount, 0);
                
                html += `<tr>
                    <td>${user.name}</td>
                    <td>${user.phone}</td>
                    <td>${userOrders.length}</td>
                    <td>Â¥${totalAmount.toFixed(2)}</td>
                    <td>Â¥${pendingAmount.toFixed(2)}</td>
                    <td>
                        <button class="action-btn btn-check" onclick="viewPaishouOrders('${user.phone}')">æŸ¥çœ‹æŠ¥å•</button>
                    </td>
                </tr>`;
            });
            
            tbody.innerHTML = html;
        }
        
        function viewPaishouOrders(phone) {
            const userOrders = orders.filter(o => o.paishouPhone === phone);
            
            let html = '<h4>æŠ¥å•åˆ—è¡¨ï¼š</h4>';
            userOrders.forEach(order => {
                html += `
                    <div style="border: 1px solid #eee; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <p>æŠ¥å•å·ï¼š${order.id}</p>
                        <p>é‡‘é¢ï¼šÂ¥${order.totalAmount.toFixed(2)}</p>
                        <p>çŠ¶æ€ï¼š${order.status === 'pending' ? 'å¾…æ ¸å¯¹' : order.status === 'matched' ? 'å·²ç»“è´¦' : 'éƒ¨åˆ†æ ¸å¯¹'}</p>
                        <p>æ—¶é—´ï¼š${order.createTime}</p>
                    </div>
                `;
            });
            
            document.getElementById('detailContent').innerHTML = html;
            document.getElementById('detailModal').classList.add('active');
        }
        
        // åˆ†äº«é“¾æ¥
        function copyShareLink() {
            const shareUrl = document.getElementById('shareUrl');
            shareUrl.select();
            document.execCommand('copy');
            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }
        
        // é€šç”¨åŠŸèƒ½
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
        
        // æ£€æŸ¥URLå‚æ•°ï¼Œç›´æ¥è¿›å…¥æ‹æ‰‹ç«¯
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const paishou = urlParams.get('paishou');
            
            if (paishou === 'login') {
                // æ˜¾ç¤ºæ‹æ‰‹ç™»å½•
                document.getElementById('loginPage').style.display = 'flex';
            }
            
            // åˆå§‹åŒ–äº§å“åˆ—è¡¨
            const productList = document.getElementById('productList');
            if (productList) {
                productList.innerHTML = `
                    <div class="product-item">
                        <input type="text" placeholder="äº§å“åç§°" class="product-name">
                        <input type="text" placeholder="å£å‘³/è§„æ ¼" class="product-spec">
                        <input type="number" placeholder="æ•°é‡" class="product-quantity" value="1" min="1">
                        <input type="text" placeholder="å›ºå" class="product-gufan">
                        <button class="remove-product" onclick="removeProductField(this)">Ã—</button>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>